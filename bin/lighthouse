#!/usr/bin/env node

var fs = require("fs")
var execSync = require('child_process').execSync;
var countriesData = require('../data/countries.json');

console.log("Starting lighthouse script...");

countriesData.countries.forEach((item, i) => {
  var reportPath = `./data/${item.tld}.json`
  if(!fs.existsSync(reportPath)) {
    console.log(`Generating report for ${item.name} (${item.url}) -> ${reportPath}`);
    try {
      execSync(`npx lighthouse ${item.url}  --output json > ${reportPath}`);
      console.log(`Successfully generated report for ${item.name}`);
    }
    catch(err) {
      console.log(`Lighthouse failed on ${item.url}:`, err.message);
      // TODO: Decide if you want to 'return' here or continue with other countries
    }
  } else {
    console.log(`Report for ${item.name} (${item.tld}.json) already exists. Skipping.`);
  }
});

console.log("Lighthouse script finished.");
